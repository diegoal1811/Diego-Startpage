---
import { config } from "../config";
---

<div
    id="links-container"
    class="grid grid-cols-1 md:grid-cols-3 gap-8"
    style={{
        "--primary-color": "var(--theme-primary)",
        "--secondary-color": "var(--theme-secondary)",
        "--foreground-color": "var(--theme-fg)",
    }}
>
    {
        config.links.map((category) => (
            <div class="category">
                <h3 class="text-[var(--secondary-color)] text-xl font-bold mb-4 border-b border-[#f9e2af]/20 pb-2">
                    {category.name}
                </h3>
                <ul class="space-y-2">
                    {category.items.map((item) => (
                        <li>
                            <a
                                href={item.url}
                                class="link-item flex items-center space-x-2 hover:text-[var(--primary-color)] transition-colors group"
                            >
                                <span>{item.name}</span>
                            </a>
                        </li>
                    ))}
                </ul>
            </div>
        ))
    }
</div>

<script>
    import { config } from "../config"; // Import config to get default colors if needed, though we use vars now.

    const input = document.getElementById("prompt-input") as HTMLInputElement;
    const container = document.getElementById("links-container");

    // 1. Check for Custom Links
    const storedLinks = localStorage.getItem("custom_links");
    if (storedLinks && container) {
        try {
            const links = JSON.parse(storedLinks);
            if (Array.isArray(links) && links.length > 0) {
                // Clear existing
                container.innerHTML = "";

                // Rebuild from JSON
                links.forEach((category) => {
                    if (!category.items || category.items.length === 0) return;

                    const catDiv = document.createElement("div");
                    catDiv.className = "category";

                    const h3 = document.createElement("h3");
                    h3.className =
                        "text-[var(--theme-secondary)] text-xl font-bold mb-4 border-b border-[#f9e2af]/20 pb-2";
                    h3.textContent = category.name;
                    catDiv.appendChild(h3);

                    const ul = document.createElement("ul");
                    ul.className = "space-y-2";

                    category.items.forEach((item: any) => {
                        const li = document.createElement("li");
                        const a = document.createElement("a");
                        a.href = item.url;
                        a.className =
                            "link-item flex items-center space-x-2 hover:text-[var(--theme-primary)] transition-colors group";
                        a.innerHTML = `<span>${item.name}</span>`;

                        li.appendChild(a);
                        ul.appendChild(li);
                    });

                    catDiv.appendChild(ul);
                    container.appendChild(catDiv);
                });
            }
        } catch (e) {
            console.error("Error loading custom links", e);
        }
    }

    // 2. Search Logic (Existing)
    const categories = document.querySelectorAll(".category");

    input?.addEventListener("input", (e) => {
        const value = (e.target as HTMLInputElement).value.toLowerCase();

        categories.forEach((category) => {
            const title =
                category.querySelector("h3")?.textContent?.toLowerCase() || "";
            const links = category.querySelectorAll(".link-item");
            let hasVisibleLinks = false;

            // Check if category matches search
            const isCategoryMatch = title.includes(value);

            links.forEach((link) => {
                const text = link.textContent?.toLowerCase() || "";
                const parent = link.closest("li");

                // If category matches, show all links. Otherwise check link text.
                if (isCategoryMatch || text.includes(value)) {
                    parent!.style.display = "block";
                    hasVisibleLinks = true;
                } else {
                    parent!.style.display = "none";
                }
            });

            // Show/hide category based on visible links
            if (hasVisibleLinks) {
                (category as HTMLElement).style.display = "block";
            } else {
                (category as HTMLElement).style.display = "none";
            }
        });
    });
</script>
